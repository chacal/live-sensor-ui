(this["webpackJsonplive-sensor-ui"]=this["webpackJsonplive-sensor-ui"]||[]).push([[0],{113:function(e,t){},115:function(e,t){},141:function(e,t){},142:function(e,t){},146:function(e,t){},156:function(e,t,r){},159:function(e,t,r){},160:function(e,t,r){"use strict";r.r(t);var s=r(14),n=r(81),a=r.n(n),i=r(82),o=r(86),c=r(28),u=r(29),l=r(35),d=r(32),h=(r(91),r(83)),b=r.n(h),m=r(170),v=r(162),f=r(171),j=r(163),k=r(164),p=r(172),g=r(85),y=r(168),O=r(165),S=r(169),x=r(166),C=r(167),B=r(84),N=r.n(B),w=(r(156),r(1)),E=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(){return Object(c.a)(this,r),t.apply(this,arguments)}return Object(u.a)(r,[{key:"render",value:function(){return Object(w.jsx)("button",{type:"button",className:"btn btn-light btn-sm clearButton",onClick:this.sendEmptyStateToMqttBroker.bind(this),children:"Clear"})}},{key:"sendEmptyStateToMqttBroker",value:function(){this.props.mqttClient.publish("/sensor/".concat(this.props.instance,"/").concat(this.props.tag,"/state"),null,{qos:1,retain:!0})}}]),r}(s.Component),V=[{name:"Haukkakallio",url:"wss://haukkakallio.chacal.fi:9883",username:"",password:""},{name:"Freya",url:"ws://freya-raspi.chacal.fi:9883",username:"",password:""}];function M(e){return function(t){return"number"===typeof t[e]?t[e].toFixed(2):"N/A"}}function q(e){return e.enabled?"Engaged: ".concat(Math.round(180*e.course/Math.PI),"\xb0M"):"Disengaged"}function P(e){return e.rssi+"dB (ACK: "+e.ackSent+")"}function T(e){return e.motionDetected?"Triggered":"Not triggered"}function A(e){return e.vcc?(e.vcc/1e3).toFixed(3):"N/A"}function H(e){return e.brokerState.brokers[e.brokerState.selected]}var L=function(e){Object(l.a)(r,e);var t=Object(d.a)(r);function r(e){var s;return Object(c.a)(this,r),(s=t.call(this,e)).state={sensorValues:{},brokerState:localStorage.brokerState?JSON.parse(localStorage.brokerState):{brokers:V,selected:0}},s.mqttClient=s.startMqttClient(H(s.state)),s}return Object(u.a)(r,[{key:"render",value:function(){return Object(w.jsxs)("div",{className:"container",children:[Object(w.jsxs)("div",{className:"row justify-content-between",children:[Object(w.jsx)("div",{className:"col-md-auto",children:Object(w.jsx)("h3",{children:"Sensors"})}),Object(w.jsx)("div",{className:"col-md-auto",children:Object(w.jsxs)("form",{className:"form-inline",children:[Object(w.jsxs)("label",{children:["Broker:",Object(w.jsx)("select",{className:"brokerSelect form-control form-control-sm",name:"mqttBroker",value:this.state.brokerState.selected,onChange:this.onMqttBrokerChanged.bind(this),children:V.map((function(e,t){return Object(w.jsx)("option",{value:t,children:e.name},e.url)}))})]}),Object(w.jsxs)("label",{children:["User:",Object(w.jsx)("input",{className:"username form-control form-control-sm",name:"username",value:H(this.state).username,onChange:this.onUsernameChanged.bind(this)})]}),Object(w.jsxs)("label",{children:["Password:",Object(w.jsx)("input",{className:"password form-control form-control-sm",name:"password",type:"password",value:H(this.state).password,onChange:this.onPasswordChanged.bind(this)})]})]})})]}),Object(w.jsxs)("div",{className:"row",children:[this.renderTemperatures(this.state.sensorValues),this.renderHumidities(this.state.sensorValues),this.renderPressures(this.state.sensorValues),this.renderTankLevels(this.state.sensorValues),this.renderCurrents(this.state.sensorValues),this.renderVoltages(this.state.sensorValues),this.renderElectricEnergyLevels(this.state.sensorValues),this.renderLevelReports(this.state.sensorValues),this.renderAutopilotStates(this.state.sensorValues),this.renderRFM69GwStats(this.state.sensorValues),this.renderPirSensors(this.state.sensorValues)]})]})}},{key:"onMqttBrokerChanged",value:function(e){var t=this;this.mqttClient.end();var r=e.target.value;this.setState((function(e){var s={sensorValues:{},brokerState:m.a(v.a("selected"),r,e.brokerState)};return localStorage.brokerState=JSON.stringify(s.brokerState),t.mqttClient=t.startMqttClient(H(s)),s}))}},{key:"onUsernameChanged",value:function(e){this.updateStateBrokerProp("username",e.target.value)}},{key:"onPasswordChanged",value:function(e){this.updateStateBrokerProp("password",e.target.value)}},{key:"updateStateBrokerProp",value:function(e,t){this.setState((function(r){var s=r.brokerState.selected,n=f.a(["brokerState","brokers",s,e]),a=m.a(n,t,r);return localStorage.brokerState=JSON.stringify(a.brokerState),a}))}},{key:"startMqttClient",value:function(e){var t=this,r=b.a.connect(e.url,j.a(["username","password"],e));return r.on("connect",(function(){r.subscribe("/sensor/+/+/state"),r.on("message",t.onMqttMessage.bind(t))})),r}},{key:"onMqttMessage",value:function(e,t){var r=e.split("/"),s=Object(o.a)(r,4),n=s[2]+"_"+s[3];if(0===t.length)this.setState((function(e){return{sensorValues:k.a([n],e.sensorValues)}}));else try{var a=JSON.parse(t);this.setState((function(e){return{sensorValues:p.a(e.sensorValues,Object(i.a)({},n,a))}}))}catch(c){console.warn("Exception when handling MQTT message:",t.toString(),c)}}},{key:"renderTemperatures",value:function(e){return this.renderBasicEvents(e,["t","m"],M("temperature"),"Temperature","\xb0C")}},{key:"renderHumidities",value:function(e){return this.renderBasicEvents(e,["h","m"],M("humidity"),"Humidity","%H")}},{key:"renderPressures",value:function(e){return this.renderBasicEvents(e,["p","m"],M("pressure"),"Pressure","mbar")}},{key:"renderTankLevels",value:function(e){return this.renderBasicEvents(e,"w",M("tankLevel"),"Tank level","%")}},{key:"renderCurrents",value:function(e){return this.renderBasicEvents(e,"c",M("current"),"Current","A")}},{key:"renderVoltages",value:function(e){return this.renderBasicEvents(e,"v",A,"Voltage","V")}},{key:"renderElectricEnergyLevels",value:function(e){return this.renderBasicEvents(e,"e",M("ampHours"),"Electric energy level","Ah")}},{key:"renderLevelReports",value:function(e){return this.renderBasicEvents(e,"r",g.a("level"),"Level Report","")}},{key:"renderAutopilotStates",value:function(e){return this.renderBasicEvents(e,"b",q,"Autopilot","")}},{key:"renderRFM69GwStats",value:function(e){return this.renderBasicEvents(e,"s",P,"RFM69 GW Stats","")}},{key:"renderPirSensors",value:function(e){return this.renderBasicEvents(e,"k",T,"PIR","")}},{key:"renderBasicEvents",value:function(e,t,r,s,n){var a=this,i=function(e,t){var r=Array.isArray(t)?t:[t];return y.a(O.a,S.a(x.a((function(e){return r.includes(e)}),"tag")),C.a(g.a("instance")))(e)}(e,t);return i.length>0?Object(w.jsxs)("div",{className:"col-12",children:[Object(w.jsx)("h4",{children:s}),Object(w.jsx)("table",{className:"table table-striped table-bordered text-right basic-event",children:Object(w.jsx)("tbody",{children:i.map((function(e){return Object(w.jsxs)("tr",{children:[Object(w.jsx)("td",{className:"instance",children:e.instance}),Object(w.jsx)("td",{className:"value",children:r(e)+" "+n}),Object(w.jsx)("td",{className:"vcc",children:A(e)+" V"}),Object(w.jsx)("td",{className:"rssi",children:e.rssi?e.rssi+" dBm":"-"}),Object(w.jsx)("td",{className:"timestamp",children:N()(e.ts).format("HH:mm:ss")}),Object(w.jsx)("td",{className:"clear",children:Object(w.jsx)(E,{tag:e.tag,instance:e.instance,mqttClient:a.mqttClient})})]},e.instance)}))})})]}):void 0}}]),r}(s.Component);r(158),r(159);a.a.render(Object(w.jsx)(L,{}),document.getElementById("root"))},91:function(e,t,r){},95:function(e,t){},97:function(e,t){}},[[160,1,2]]]);
//# sourceMappingURL=main.10f27578.chunk.js.map